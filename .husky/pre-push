#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Pre-push hook to ensure code quality before pushing
echo "ğŸš€ Running pre-push checks..."

# Get the current branch name
current_branch=$(git rev-parse --abbrev-ref HEAD)

# Check if pushing to main branch
if [ "$current_branch" = "main" ]; then
  echo "âš ï¸  Pushing directly to main branch..."
  
  # Run build to ensure everything compiles
  echo "ğŸ—ï¸  Running production build..."
  npm run build
  if [ $? -ne 0 ]; then
    echo "âŒ Build failed. Please fix errors before pushing to main."
    exit 1
  fi
  
  echo "âœ… Build successful. Push to main allowed."
else
  # For feature branches, just run quick checks
  echo "ğŸ“¦ Running TypeScript check..."
  npm run typecheck
  if [ $? -ne 0 ]; then
    echo "âŒ TypeScript compilation failed. Please fix errors before pushing."
    exit 1
  fi
fi

echo "âœ… All pre-push checks passed!"